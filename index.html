<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Transactions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            text-align: center;
        }
        h1 {
            color: #333;
        }
        .container {
            width: 80%;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        input, button {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
            word-break: break-word;
        }
        th {
            background: #007bff;
            color: white;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <h1>MiniChain Project
            By Deptanshu Bhowmick
    </h1>
    <div class="container">
        <h2>Submit Transaction</h2>
        <input type="text" id="sender" placeholder="Sender Address">
        <input type="text" id="receiver" placeholder="Receiver Address">
        <input type="number" id="amount" placeholder="Amount">
        <button onclick="submitTransaction()">Submit</button>
        
        <h2>Pending Transactions</h2>
        <table>
            <thead>
                <tr>
                    <th>Sender</th>
                    <th>Receiver</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody id="transactionTable"></tbody>
        </table>

        <button onclick="mineBlock()">Mine Block</button>

        <h2>Blockchain Ledger</h2>
        <table>
            <thead>
                <tr>
                    <th>Index</th>
                    <th>Timestamp</th>
                    <th>Transactions</th>
                    <th>Hash</th>
                </tr>
            </thead>
            <tbody id="ledgerTable"></tbody>
        </table>
    </div>

    <script>
        async function fetchTransactions() {
            const response = await fetch('/get_transactions');
            const transactions = await response.json();
            const table = document.getElementById('transactionTable');
            table.innerHTML = "";
            transactions.forEach(tx => {
                table.innerHTML += `<tr>
                                        <td>${tx.sender}</td>
                                        <td>${tx.receiver}</td>
                                        <td>${tx.amount}</td>
                                    </tr>`;
            });
        }

        async function fetchChain() {
            const response = await fetch('/get_chain');
            const chain = await response.json();
            const table = document.getElementById('ledgerTable');
            table.innerHTML = "";
            chain.forEach(block => {
                table.innerHTML += `<tr>
                                        <td>${block.index}</td>
                                        <td>${new Date(block.timestamp * 1000).toLocaleString()}</td>
                                        <td>${JSON.stringify(block.transactions)}</td>
                                        <td>${block.hash}</td>
                                    </tr>`;
            });
        }

        async function submitTransaction() {
            const sender = document.getElementById('sender').value;
            const receiver = document.getElementById('receiver').value;
            const amount = document.getElementById('amount').value;

            if (!sender || !receiver || !amount) {
                alert("All fields are required!");
                return;
            }

            await fetch('/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sender, receiver, amount })
            });

            fetchTransactions();
        }
//todo rem comments 
        async function mineBlock() {
            await fetch('/mine', { method: 'POST' });
            fetchTransactions();  // Update pending transactions (clears them)
            fetchChain();  // Update the ledger with the new block
        }

        fetchTransactions();
        fetchChain();
    </script>
</body>
</html>
